<!-- app/views/products/show.html.erb -->

<div class="product-page-container">

  <!-- Sticky header: static page title -->
  <div class="wrapper-that-freezes-things">
    <div class="products-header">
      <div class="page-title">
        <span class="page-title__text">Renegotiate Product</span>
      </div>
    </div>
  </div>

  <!-- Detail card -->
  <div class="card-wrapper">
    <div class="card-pro">
      <!-- Product & supplier inside the card -->
      <div class="card-pro__title">
        <h2 style="margin:0; font-size:1.5rem; font-weight:600;">
          <%= @product.name %>
        </h2>
        <% if (s = @product.supplier) %>
          <p style="margin:0.25rem 0 1rem; color:#555;">
            <strong>Supplier:</strong> <%= s.company_name %>
          </p>
        <% end %>
      </div>

      <hr>

      <!-- Supplier email -->
      <% if s && s.contact_email.present? %>
        <p class="card-pro__content">
          <strong>Email:</strong>
          <%= mail_to s.contact_email, s.contact_email, class: "product-email-link" %>
        </p>
      <% end %>

      <!-- Description -->
      <p class="card-pro__content">
        <strong>Description:</strong><br>
        <%= @product.description.presence || "No description available." %>
      </p>

      <!-- Contract details -->
      <p class="card-pro__content">
        <strong>Current Price:</strong> <%= number_to_currency(@product.current_price) %><br>
        <strong>Ends:</strong>          <%= l(@product.contract_end_date) %>
      </p>

      <!-- Purchase volumes -->
      <p class="card-pro__content">
        <strong>Last 30 days:</strong>   <%= @product.last_month_volume %> units<br>
        <strong>Last 12 months:</strong> <%= @product.last_year_volume  %> units
      </p>

      <!-- Status -->
      <% latest = @product.renegotiations.order(created_at: :desc).first
         status = latest&.status.present? ? latest.status.downcase.tr(' ', '_') : "pending" %>
      <p class="card-pro__content">
        <strong>Status:</strong>
        <span class="status <%= status %>"><%= status.titleize %></span>
      </p>

      <!-- Renegotiate button -->
      <div class="card-pro__actions">
        <%= link_to "Renegotiate",
                    new_product_renegotiation_path(@product),
                    class: "import-btn" %>
      </div>
    </div>
  </div>

  <!-- Back to results -->
  <div class="text-center" style="margin-top: 1.5rem;">
    <%= link_to "← Back to results",
                products_path,
                class: "import-btn" %>
  </div>

</div>
